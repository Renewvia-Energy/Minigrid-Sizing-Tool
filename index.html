<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="main.css">
		<title>Minigrid Design Tool</title>

		<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
	</head>
	<body>
		<header>
				<img src="images/logo.png" alt="logo" class="logo">
				<h1>MINIGRID DESIGN TOOL</h1>
		</header>

		<main>
			<form>
				<div class="q">
					<label for="cred-file">Upload Credentials</label>
					<input type="file" id="cred-file" name="cred-file" accept=".json" required>
				</div>

				<div id="form-from-json">
					<!-- For each section in form.json -->
					<section v-for="section in sections" :id="section.key">

						<!-- Display the section header -->
						<h2>{{section.header}}</h2>

						<!-- For each form question in the section -->
						<div v-for="question in section.questions">

							<!-- If the question is multiple choice -->
							<fieldset v-if="question.type === 'fieldset'" :id="createId(section, question)">
								<legend>{{question.label}}</legend>
								<div v-for="option in question.options">
									<input type="radio" :id="createId(section, question).concat('-',option.value)" :name="createId(section, question)" v-model="option.value" checked>
									<label :for="createId(section, question).concat('-',option.value)">{{option.label}}</label>
								</div>
							</fieldset>

							<!-- If the question is a table -->
							<table v-else-if="question.type === 'table'">
								<caption>{{question.label}}</caption>
								<tr>
									<th></th>
									<th v-for="header in question.headers">{{header}}</th>
								</tr>
								<tr>
									<td></td>
								</tr>
							</table>

							<!-- If the question is actually a subsection header -->
							<h3 v-else-if="question.type === 'header'">{{question.label}}</h3>

							<!-- If the question asks for a number, check, or text -->
							<div v-else class="q">
								<label :for="createId(section, question)">{{question.label}}</label>
								<input :type="question.type" :name="createId(section, question)" :id="createId(section, question)" v-model="question.default" :required="!(question.type === 'checkbox')">
								<span v-if="'unit' in question" class="unit">{{question.unit}}</span>
							</div>
						</div>
					</section>
				</div>
			</form>
		</main>

		<!-- <script src="functions.js"></script> -->
		<script>
			const { createApp } = Vue

			var formData;
			var equipmentData;

			createApp({
				data() {
					fetch('https://renewvia-energy.github.io/Minigrid-Sizing-Tool/equipment.json')
						.then(response => response.json())
						.then(jsonData => {
							equipmentData = jsonData
						})

					fetch('https://renewvia-energy.github.io/Minigrid-Sizing-Tool/form.json')
						.then(response => response.json())
						.then(jsonData => {
							formData = jsonData;
							for (let section of jsonData) {
								if (!('key' in section)) {
									section.key = section['header'].toLowerCase().replace(' ','_');
								}
								for (let question of section.questions) {
									if (!('type' in question)) {
										question.type = 'number';
									}
								}
							}
							this.sections = jsonData;
						});
					return {
						sections: []
					}
				},
				methods: {
					createId(section, q) {
						return section.key.concat('key' in q ? q.key : q.label.toLowerCase()).replace(' ', '_');
					}
				}
			}).mount('#form-from-json')
		</script>
	</body>
</html>