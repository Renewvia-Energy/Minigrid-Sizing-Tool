<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="stylesheet" href="main.css">
		<title>Minigrid Design Tool</title>

		<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
	</head>
	<body>
		<header>
				<img src="images/logo.png" alt="logo" class="logo">
				<h1>MINIGRID DESIGN TOOL</h1>
		</header>

		<main>
			<form>
				<div class="q">
					<label for="cred-file">Upload Credentials</label>
					<input type="file" id="cred-file" name="cred-file" accept=".json" required>
				</div>

				<div id="form-from-json">
					<section v-for="section in sections" :id="section.key">
						<h2>{{section.header}}</h2>
						<div v-for="question in section.questions">
							<fieldset v-if="question.type === 'fieldset'" :id="createId(section, question)">
								<legend>{{question.label}}</legend>
								<div v-for="option in question.options">
									<input type="radio" :id="createId(section, question).concat('-',option.value)" :name="createId(section, question)" :value="option.value" checked>
									<label :for="createId(section, question).concat('-',option.value)">{{option.label}}</label>
								</div>
							</fieldset>
							<div v-else class="q">
								<label :for="createId(section, question)">{{question.label}}</label>
								<input :type="question.type" :name="createId(section, question)" :id="createId(section, question)" :value="question.default" required>
								<span v-if="'unit' in question" class="unit">{{question.unit}}</span>
							</div>
						</div>
					</section>
				</div>
			</form>
		</main>

		<!-- <script src="functions.js"></script> -->
		<script>
			const { createApp } = Vue

			let id = 0;

			createApp({
				data() {
					fetch('https://renewvia-energy.github.io/Minigrid-Sizing-Tool/form.json')
						.then(response => response.json())
						.then(jsonData => {
							for (section in jsonData) {
								for (question in section.questions) {
									if (!('type' in question)) {
										question.type = 'number';
									}
								}
							}
							this.sections = jsonData;
						});
					return {
						sections: []
					}
				},
				methods: {
					createId(section, q) {
						return section.key.concat('key' in q ? q.key : q.label.toLowerCase()).replace(' ', '_');
					}
				}
			}).mount('#form-from-json')
		</script>
	</body>
</html>